{"version":3,"file":"on-scroll-to.js","sources":["../modules/DOM.js","../modules/log.js","../modules/OnScrollTo.js"],"sourcesContent":["export function getScrollY() {\n  // `window.scrollY` is not supported by Internet Explorer.\n  return window.pageYOffset;\n}\nexport function getScreenBounds() {\n  var height = window.innerHeight;\n  return {\n    // The first pixel of the viewport.\n    top: getScrollY(),\n    // The pixel after the last pixel of the viewport.\n    bottom: getScrollY() + height,\n    height: height\n  };\n}\n//# sourceMappingURL=DOM.js.map","function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nexport default function log() {\n  if (typeof window !== 'undefined' && window.OnScrollToDebug) {\n    var _console;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    (_console = console).log.apply(_console, _toConsumableArray(['[on-scroll-to]'].concat(args)));\n  }\n}\n//# sourceMappingURL=log.js.map","function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { getScrollY, getScreenBounds } from './DOM';\nimport log from './log';\n\nvar OnScrollTo =\n/*#__PURE__*/\nfunction () {\n  function OnScrollTo(getElement, onScrollTo, onStateChange, options) {\n    var _this = this;\n\n    _classCallCheck(this, OnScrollTo);\n\n    _defineProperty(this, \"onScroll\", function () {\n      return _this.onCheckScrollStatus({\n        reason: 'scroll'\n      });\n    });\n\n    _defineProperty(this, \"onResize\", function () {\n      return _this.onCheckScrollStatus({\n        reason: 'resize'\n      });\n    });\n\n    _defineProperty(this, \"onIntersectViewport\", function (entries, observer) {\n      var isIntersecting = entries[0].isIntersecting;\n\n      if (isIntersecting) {\n        _this.onScrollTo();\n      }\n    });\n\n    _defineProperty(this, \"onResult\", function (hasMore) {\n      if (hasMore === true) {\n        _this.enable();\n      } else {\n        _this.hide();\n      }\n    });\n\n    _defineProperty(this, \"onError\", function (error) {\n      console.error(error);\n\n      _this.setState({\n        error: error\n      });\n    });\n\n    this.getElement = getElement;\n    this._onScrollTo = onScrollTo;\n    this.onStateChange = onStateChange;\n    this.options = _objectSpread({}, options);\n\n    if (this.options.distance === undefined) {\n      // The default trigger distance is the screen height.\n      this.options.distance = typeof window === 'undefined' ? 0 : window.innerHeight;\n    }\n\n    this.state = {};\n    log('~ Initialize ~');\n    log('Distance', this.options.distance);\n  }\n\n  _createClass(OnScrollTo, [{\n    key: \"onMount\",\n    value: function onMount() {\n      this.isMounted = true;\n      log('Mounted');\n\n      if (window.IntersectionObserver) {\n        var distance = this.options.distance; // Every modern browser except Internet Explorer supports `IntersectionObserver`s.\n        // https://developer.mozilla.org/en-US/docs/Web/API/Intersection_Observer_API\n        // https://caniuse.com/#search=IntersectionObserver\n\n        this.intersectionObserver = new IntersectionObserver(this.onIntersectViewport, {\n          root: null,\n          // top, right, bottom, left.\n          rootMargin: \"\".concat(distance, \"px 0px \").concat(distance, \"px 0px\"),\n          threshold: 0\n        });\n        this.intersectionObserver.observe(this.getElement());\n      } else {\n        window.addEventListener('scroll', this.onScroll);\n        window.addEventListener('resize', this.onResize);\n        this.onCheckScrollStatus({\n          reason: 'mount'\n        });\n      }\n    }\n  }, {\n    key: \"onUnmount\",\n    value: function onUnmount() {\n      // `OnScrollTo` unmounts itself when it becomes hidden.\n      // If a parent React component later calls `.onUnmount()` again\n      // in `.componentWillUnmount()` then do nothing.\n      if (!this.isMounted) {\n        return;\n      }\n\n      this.isMounted = false;\n      log('Unmount');\n\n      if (this.intersectionObserver) {\n        this.intersectionObserver.disconnect();\n      } else {\n        window.addEventListener('scroll', this.onScroll);\n        window.addEventListener('resize', this.onResize);\n      }\n    }\n  }, {\n    key: \"onCheckScrollStatus\",\n    value: function onCheckScrollStatus(reason) {\n      if (this.getState().loading) {\n        return;\n      }\n\n      log(\"Check scroll status (\".concat(reason, \")\"));\n\n      if (this.isVisible()) {\n        this.onScrollTo();\n      }\n    }\n  }, {\n    key: \"isVisible\",\n    value: function isVisible() {\n      var distance = this.options.distance;\n\n      var _this$getElementCoord = this.getElementCoordinates(),\n          top = _this$getElementCoord.top,\n          bottom = _this$getElementCoord.bottom;\n\n      var screen = getScreenBounds();\n      return bottom >= screen.top - distance && top <= screen.bottom + distance;\n    }\n  }, {\n    key: \"getElementCoordinates\",\n    value: function getElementCoordinates() {\n      var _this$getElement$getB = this.getElement().getBoundingClientRect(),\n          top = _this$getElement$getB.top,\n          height = _this$getElement$getB.height;\n\n      return {\n        top: top,\n        bottom: top + height\n      };\n    }\n  }, {\n    key: \"getState\",\n    value: function getState() {\n      return this.state;\n    }\n  }, {\n    key: \"setState\",\n    value: function setState(newState) {\n      log('Set state', newState);\n      this.state = _objectSpread({}, this.state, newState);\n      log('New state', this.state);\n      this.onStateChange(this.state);\n    }\n  }, {\n    key: \"onScrollTo\",\n    value: function onScrollTo() {\n      log('On scroll to');\n      this.disable();\n      executeFunction(this._onScrollTo, this.onResult, this.onError);\n    }\n  }, {\n    key: \"disable\",\n    value: function disable() {\n      log('Disable while loading');\n      this.setState({\n        loading: true\n      });\n\n      if (this.intersectionObserver) {\n        this.intersectionObserver.disconnect();\n      }\n    }\n  }, {\n    key: \"isEnabled\",\n    value: function isEnabled() {\n      var _this$getState = this.getState(),\n          loading = _this$getState.loading,\n          error = _this$getState.error;\n\n      return !loading && !error;\n    }\n  }, {\n    key: \"enable\",\n    value: function enable() {\n      log('Enable');\n      this.setState({\n        loading: undefined,\n        error: undefined\n      });\n\n      if (this.intersectionObserver) {\n        this.intersectionObserver.observe(this.getElement());\n      } else {\n        this.onCheckScrollStatus({\n          reason: 're-enable'\n        });\n      }\n    }\n  }, {\n    key: \"retry\",\n    value: function retry() {\n      if (!this.getState().error) {\n        throw new Error('[on-scroll-to] No error');\n      }\n\n      log('Retry');\n      this.enable();\n    }\n  }, {\n    key: \"hide\",\n    value: function hide() {\n      log('Hide');\n      this.setState({\n        hidden: true\n      });\n      this.onUnmount();\n    }\n  }]);\n\n  return OnScrollTo;\n}();\n\nexport { OnScrollTo as default };\n\nfunction executeFunction(func, onResult, onError) {\n  try {\n    var result = func();\n\n    if (result && typeof result.then === 'function') {\n      result.then(onResult, onError);\n    } else {\n      onResult(result);\n    }\n  } catch (error) {\n    onError(error);\n  }\n}\n//# sourceMappingURL=OnScrollTo.js.map"],"names":["getScrollY","window","pageYOffset","_toConsumableArray","arr","Array","isArray","i","arr2","length","_arrayWithoutHoles","iter","Symbol","iterator","Object","prototype","toString","call","from","_iterableToArray","TypeError","_nonIterableSpread","log","OnScrollToDebug","_console","_len","arguments","args","_key","console","apply","concat","_objectSpread","target","source","ownKeys","keys","getOwnPropertySymbols","filter","sym","getOwnPropertyDescriptor","enumerable","forEach","key","_defineProperty","_defineProperties","props","descriptor","configurable","writable","defineProperty","obj","value","OnScrollTo","getElement","onScrollTo","onStateChange","options","_this","this","instance","Constructor","_classCallCheck","onCheckScrollStatus","reason","entries","observer","isIntersecting","hasMore","enable","hide","error","setState","_onScrollTo","undefined","distance","innerHeight","state","protoProps","staticProps","isMounted","IntersectionObserver","intersectionObserver","onIntersectViewport","root","rootMargin","threshold","observe","addEventListener","onScroll","onResize","disconnect","getState","loading","isVisible","height","_this$getElementCoord","getElementCoordinates","top","bottom","screen","_this$getElement$getB","getBoundingClientRect","newState","disable","func","onResult","onError","result","then","executeFunction","_this$getState","Error","hidden","onUnmount"],"mappings":"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"}